<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Chatbot Administrativo - Eterials</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('chatbot_admin.static', filename='dashboard_simple.css') }}?v=20250917">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <div class="breadcrumb">
                    <a href="/admin" class="breadcrumb-link">
                        <i class="fas fa-home"></i> Panel Admin
                    </a>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-current">
                        <i class="fas fa-robot"></i> Dashboard Chatbot
                    </span>
                </div>
                <h1><i class="fas fa-robot"></i> Dashboard Chatbot Administrativo</h1>
                <p class="header-subtitle">Gestión completa del sistema de chatbot Eterials</p>
                <div class="header-actions">
                    <button class="btn-refresh" onclick="actualizarDashboard()">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                    <a href="/chatbot?mesa=1" target="_blank" class="btn-test" title="Probar chatbot">
                        <i class="fas fa-external-link-alt"></i> Probar Chat
                    </a>
                    <a href="/admin" class="btn-back">
                        <i class="fas fa-arrow-left"></i> Panel Principal
                    </a>
                </div>
            </div>
        </header>

        <!-- Navegación -->
        <nav class="dashboard-nav">
            <ul>
                <li><a href="#resumen" class="nav-active" onclick="mostrarSeccion('resumen')">
                    <i class="fas fa-chart-pie"></i> Resumen</a></li>
                <li><a href="#sesiones" onclick="mostrarSeccion('sesiones')">
                    <i class="fas fa-users"></i> Sesiones Activas</a></li>
                <li><a href="#calificaciones" onclick="mostrarSeccion('calificaciones')">
                    <i class="fas fa-star"></i> Calificaciones</a></li>
                <li><a href="#notificaciones" onclick="mostrarSeccion('notificaciones')">
                    <i class="fas fa-bell"></i> Notificaciones</a></li>
                <li><a href="#personalizacion" onclick="mostrarSeccion('personalizacion')">
                    <i class="fas fa-paint-brush"></i> Personalización</a></li>
                <li><a href="#configuracion" onclick="mostrarSeccion('configuracion')">
                    <i class="fas fa-cog"></i> Configuración</a></li>
            </ul>
        </nav>

        <!-- Contenido Principal -->
        <main class="dashboard-main">
            
            <!-- Sección Resumen -->
            <section id="seccion-resumen" class="dashboard-section active">
                <h2><i class="fas fa-chart-pie"></i> Resumen del Sistema</h2>
                
                <!-- Cards de Métricas -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="metric-content">
                            <h3>Sesiones Activas</h3>
                            <p class="metric-number" id="sesiones-activas">-</p>
                            <small>Usuarios conectados ahora</small>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="metric-content">
                            <h3>Calificación Promedio</h3>
                            <p class="metric-number" id="calificacion-promedio">-</p>
                            <small>Últimas 24 horas</small>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div class="metric-content">
                            <h3>Notificaciones Pendientes</h3>
                            <p class="metric-number" id="notificaciones-pendientes">-</p>
                            <small>Requieren atención</small>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="metric-content">
                            <h3>Visitas Hoy</h3>
                            <p class="metric-number" id="visitas-hoy">-</p>
                            <small>Sesiones iniciadas</small>
                        </div>
                    </div>
                </div>

                <!-- Gráfico de Actividad -->
                <div class="chart-container">
                    <h3><i class="fas fa-chart-line"></i> Actividad de las Últimas 24 Horas</h3>
                    <canvas id="grafico-actividad" width="400" height="200"></canvas>
                </div>
            </section>

            <!-- Sección Sesiones -->
            <section id="seccion-sesiones" class="dashboard-section">
                <h2><i class="fas fa-users"></i> Sesiones Activas</h2>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Mesa</th>
                                <th>Cliente</th>
                                <th>Inicio</th>
                                <th>Último Acceso</th>
                                <th>Dispositivo</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tabla-sesiones">
                            <tr class="loading-row">
                                <td colspan="7">
                                    <i class="fas fa-spinner fa-spin"></i> Cargando sesiones...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Sección Calificaciones -->
            <section id="seccion-calificaciones" class="dashboard-section">
                <h2><i class="fas fa-star"></i> Calificaciones y Comentarios</h2>
                
                <div class="filters-bar">
                    <select id="filtro-calificacion">
                        <option value="">Todas las calificaciones</option>
                        <option value="5">5 estrellas</option>
                        <option value="4">4 estrellas</option>
                        <option value="3">3 estrellas</option>
                        <option value="2">2 estrellas</option>
                        <option value="1">1 estrella</option>
                    </select>
                    <select id="filtro-categoria">
                        <option value="">Todas las categorías</option>
                        <option value="servicio">Servicio</option>
                        <option value="comida">Comida</option>
                        <option value="ambiente">Ambiente</option>
                        <option value="limpieza">Limpieza</option>
                    </select>
                    <button onclick="aplicarFiltros()">Filtrar</button>
                </div>

                <div id="lista-calificaciones" class="reviews-container">
                    <div class="loading-message">
                        <i class="fas fa-spinner fa-spin"></i> Cargando calificaciones...
                    </div>
                </div>
            </section>

            <!-- Sección Notificaciones -->
            <section id="seccion-notificaciones" class="dashboard-section">
                <h2><i class="fas fa-bell"></i> Notificaciones del Personal</h2>
                
                <div class="notifications-controls">
                    <button class="btn-primary" onclick="marcarTodasLeidas()">
                        <i class="fas fa-check-double"></i> Marcar Todas como Leídas
                    </button>
                    <select id="filtro-prioridad">
                        <option value="">Todas las prioridades</option>
                        <option value="alta">Alta</option>
                        <option value="media">Media</option>
                        <option value="baja">Baja</option>
                    </select>
                </div>

                <div id="lista-notificaciones" class="notifications-container">
                    <div class="loading-message">
                        <i class="fas fa-spinner fa-spin"></i> Cargando notificaciones...
                    </div>
                </div>
            </section>

            <!-- =============================================== -->
            <!-- SECCIÓN PERSONALIZACIÓN SIMPLIFICADA (SOLO FONDOS) -->  
            <!-- =============================================== -->
            <section id="seccion-personalizacion" class="dashboard-section">
                <h2><i class="fas fa-image"></i> Fondos de Pantalla del Chatbot</h2>
                <p class="section-description">Configura el fondo de pantalla de tu chatbot de manera sencilla y directa.</p>
                
            <!-- Panel de Control Principal -->
            <div class="personalizacion-container-modern">
                
                <!-- Columna Izquierda: Controles Modernos -->
                <div class="personalizacion-controles-modern">
                    <div class="control-section">
                        <div class="section-header">
                            <h3><i class="fas fa-palette"></i> Personalización de Fondos</h3>
                            <p class="section-subtitle">Personaliza la apariencia visual de tu chatbot</p>
                        </div>

                        <!-- Tipo de Fondo -->
                        <!-- ELIMINADO: Selector de tipo Color Sólido - Solo imágenes disponibles -->
                        <div class="fondo-type-selector">
                            <div class="type-option" data-type="imagen">
                                <div class="option-card active" onclick="seleccionarTipoFondo('imagen')">
                                    <div class="option-icon">
                                        <i class="fas fa-image"></i>
                                    </div>
                                    <div class="option-info">
                                        <h4>Imagen Personalizada</h4>
                                        <p>Sube o selecciona una imagen de fondo (Sistema simplificado)</p>
                                    </div>
                                    <div class="option-check">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ELIMINADO: Panel Configuración Color - Sistema simplificado solo con imágenes -->

                        <!-- Panel Configuración Imagen -->
                        <div id="config-imagen-fondo" class="config-panel active">
                            <div class="panel-header">
                                <h4><i class="fas fa-images"></i> Gestión de Imágenes</h4>
                            </div>
                            
                            <!-- Upload Area -->
                            <div class="upload-area-modern">
                                <div class="upload-zone" onclick="document.getElementById('input-nueva-imagen').click()">
                                    <div class="upload-content">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <h5>Subir Nueva Imagen</h5>
                                        <p>Haz clic aquí o arrastra una imagen</p>
                                        <span class="upload-formats">JPG, PNG, GIF hasta 5MB</span>
                                    </div>
                                </div>
                                <input type="file" id="input-nueva-imagen" accept="image/*" style="display: none;">
                            </div>

                            <!-- Galería de Fondos -->
                            <div class="fondos-gallery-modern">
                                <div class="gallery-header">
                                    <h5><i class="fas fa-folder-open"></i> Fondos Disponibles</h5>
                                    <span class="fondos-count" id="fondos-counter">Cargando...</span>
                                </div>
                                <div id="galeria-fondos-grid" class="fondos-grid">
                                    <div class="loading-placeholder">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <p>Cargando fondos disponibles...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- SISTEMA SIMPLIFICADO - Solo imágenes de fondo -->
                        </div>

                        <!-- Botones de Acción -->
                        <div class="action-buttons-modern">
                            <button type="button" class="btn-action-primary" onclick="aplicarSoloFondo()">
                                <i class="fas fa-magic"></i>
                                <span>Aplicar Cambios</span>
                            </button>
                            <button type="button" class="btn-action-secondary" onclick="resetearFondo()">
                                <i class="fas fa-undo-alt"></i>
                                <span>Restaurar Original</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Columna Derecha: Vista Previa Expandida -->
                <div class="personalizacion-preview-modern">
                    <div class="preview-section">
                        <div class="preview-header">
                            <h3><i class="fas fa-eye"></i> Vista Previa en Tiempo Real</h3>
                            <div class="preview-controls">
                                <button class="btn-preview-refresh" onclick="actualizarPreviewFondo()" title="Actualizar Preview">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <a href="/chatbot" target="_blank" class="btn-preview-full" title="Abrir en Pestaña Nueva">
                                    <i class="fas fa-external-link-alt"></i>
                                </a>
                            </div>
                        </div>
                        
                        <div class="preview-container-modern">
                            <div class="preview-device">
                                <div class="device-frame">
                                    <iframe 
                                        id="preview-iframe" 
                                        src="/chatbot" 
                                        class="chatbot-preview"
                                        title="Vista previa del chatbot">
                                    </iframe>
                                </div>
                                <div class="device-info">
                                    <span class="device-label">Vista del Cliente</span>
                                    <span class="device-resolution">Responsive • Tiempo Real</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Estado Actual -->
                    <div class="estado-actual-modern">
                        <div class="estado-header">
                            <h4><i class="fas fa-info-circle"></i> Estado Actual</h4>
                        </div>
                        <div class="estado-content">
                            <div class="estado-item">
                                <div class="estado-label">Fondo Activo:</div>
                                <div class="estado-value" id="fondo-actual-nombre">Color sólido #1a1a1a</div>
                            </div>
                            <div class="estado-item">
                                <div class="estado-label">Última Actualización:</div>
                                <div class="estado-value" id="ultima-actualizacion">Nunca</div>
                            </div>
                            <div class="estado-item">
                                <div class="estado-label">Modo:</div>
                                <div class="estado-value" id="modo-actual">Personalización Manual</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Sección Configuración -->
            <section id="seccion-configuracion" class="dashboard-section">
                <h2><i class="fas fa-cog"></i> Configuración del Sistema</h2>
                
                <form id="form-configuracion" class="config-form">


                    <div class="config-group">
                        <h3>Configuración General</h3>
                        <div class="form-row">
                            <label for="sesion-timeout">Timeout de Sesión (minutos):</label>
                            <input type="number" id="sesion-timeout" min="5" max="120">
                        </div>
                        <div class="form-row">
                            <label for="calificacion-obligatoria">
                                <input type="checkbox" id="calificacion-obligatoria">
                                Calificación obligatoria antes de salir
                            </label>
                        </div>
                        <div class="form-row">
                            <label for="tema-por-defecto">Tema por Defecto:</label>
                            <select id="tema-por-defecto">
                                <option value="">Cargando temas...</option>
                            </select>
                        </div>
                    </div>

                    <div class="config-group">
                        <h3><i class="fas fa-utensils"></i> Gestión de Menús</h3>
                        
                        <!-- MENÚ PRINCIPAL -->
                        <div class="menu-section">
                            <h4><i class="fas fa-home"></i> Menú Principal (Interno)</h4>
                            <div class="form-row">
                                <label for="menu-principal-habilitado">
                                    <input type="checkbox" id="menu-principal-habilitado" checked>
                                    <span class="checkbox-label">Habilitar Menú Principal</span>
                                </label>
                                <small class="help-text">Menú interno del sistema con productos, categorías y precios</small>
                            </div>
                            <div class="form-row">
                                <label for="menu-principal-url">URL del Menú Principal:</label>
                                <input type="text" id="menu-principal-url" value="/menu/general" />
                                <small class="help-text">Ruta del menú principal del sistema</small>
                            </div>
                            <div class="form-row">
                                <button type="button" class="btn-secondary" onclick="probarMenuPrincipal()">
                                    <i class="fas fa-external-link-alt"></i> Probar Menú Principal
                                </button>
                            </div>
                        </div>

                        <!-- MENÚ ALTERNATIVO -->
                        <div class="menu-section">
                            <h4><i class="fas fa-external-link-alt"></i> Menú Alternativo (Externo)</h4>
                            <div class="form-row">
                                <label for="menu-alternativo-habilitado">
                                    <input type="checkbox" id="menu-alternativo-habilitado">
                                    <span class="checkbox-label">Habilitar Menú Alternativo</span>
                                </label>
                                <small class="help-text">Redirigir a un menú externo (carta digital, promociones, etc.)</small>
                            </div>
                            <div class="form-row">
                                <label for="menu-alternativo-url">URL del Menú Alternativo:</label>
                                <input type="url" id="menu-alternativo-url" placeholder="https://ejemplo.com/menu-especial" />
                                <small class="help-text">URL completa del menú externo</small>
                            </div>
                            <div class="form-row">
                                <button type="button" class="btn-secondary" onclick="probarMenuAlternativo()">
                                    <i class="fas fa-external-link-alt"></i> Probar Menú Alternativo
                                </button>
                            </div>
                        </div>

                        <!-- ESTADO GENERAL -->
                        <div class="form-row">
                            <div class="menu-status" id="menu-status">
                                <i class="fas fa-info-circle text-warning"></i> 
                                <span>Configura los menús según las necesidades del restaurante</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i> Guardar Configuración
                        </button>
                        <button type="button" class="btn-secondary" onclick="resetearConfiguracion()">
                            <i class="fas fa-undo"></i> Resetear
                        </button>
                    </div>
                </form>
            </section>

        </main>
    </div>

        <!-- JavaScript Dashboard Funcional -->
    <script src="{{ url_for('chatbot_admin.static', filename='dashboard_funcional.js') }}"></script>
</body>
</html>